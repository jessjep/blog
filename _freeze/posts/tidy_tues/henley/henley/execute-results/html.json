{
  "hash": "09f916f4e2cf619dab2489c948d4d09c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tidy Tuesday: Henley Passport Index\"\ndate: 2025-09-11\nexecute:\n  echo: true\n  warning: false\n  message: false\nimage: \"henley.png\"\ntags: \n  - tidytuesday\n---\n\n\n\n![](henley.png)\n\nThis week I made a plot to visualise which countries' passport holders had the most travel freedom - relative to how many countries from which other people can enter without a visa.\n\nThe plot excludes countries like Australia where no one can enter visa-free (hence why New Zealand tops Oceania). I didn't have time to problem-solve how to include these.\n\nThings I learned this week:\n\n-   how to parse json data in R\n\n-   how to use {ggtext} to add italics to a subtitle\n\n-   how to control the jitter of geom_point using 'position = position_jitter(width = x)'\n\n-   there is a small island country called Niue that looks delightful\n\n#### Code\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Load data and libraries\"}\ntuesdata <- tidytuesdayR::tt_load(2025, week = 36)\n\ncountry_lists <- tuesdata$country_lists\nrank_by_year <- tuesdata$rank_by_year\n\nlibrary(jsonlite)\nlibrary(tidyverse)\nlibrary(ggtext)\nlibrary(paletteer)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Parse the json data\"}\nfree_access <- country_lists %>%\n  select(code, country, visa_free_access) %>%\n  rename(origin_code = code,\n         origin_country = country) %>%\n  \n# Temporarily create a new column where the parsed json data will be stored (json_data)\n  \n  mutate(json_data = map(visa_free_access, ~ { \n\n# the map() function from purrr applies the following functions to every row (each json dataframe, represented by '.x') of the visa_free_access column\n    \n      jsdata <- fromJSON(.x) # converts/parses the json data into an R list\n      as_tibble(jsdata[[1]]) # turns the list into a tibble\n    })) %>%\n\n# unnest the data so that it is no longer dataframes within a dataframe (lengthens the df)\n  \n  unnest(json_data) %>%\n  rename(dest_code = code,\n         dest_country = name) %>%\n  select(-visa_free_access)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Wrangle the data for plotting\"}\nfree_access <- free_access %>%\n  group_by(dest_country) %>%\n  count(name = \"countries_with_free_access\") %>%\n  ungroup() %>%\n  left_join(rank_by_year, join_by(dest_country == country)) %>%\n  filter(year == 2025) %>%\n  group_by(region) %>%\n  mutate(relative_travel_freedom = visa_free_count - countries_with_free_access,\n         median_rel_travel_freedom = median(relative_travel_freedom)) %>%\n  ungroup() %>%\n  mutate(region = fct_reorder(factor(region), median_rel_travel_freedom, .desc = TRUE))\n\n# create dfs for the labelling (top and bottom 5)\ntop5 <- free_access %>%\n  group_by(region) %>%\n  slice_max(order_by = relative_travel_freedom, n = 1) %>%\n  ungroup()\n\nbottom5 <- free_access %>%\n  group_by(region) %>%\n  slice_min(order_by = relative_travel_freedom, n = 1) %>%\n  ungroup()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Create the plot\"}\np <- ggplot(free_access, \n            aes(region,\n                relative_travel_freedom,\n                color = region)) +\n  geom_point(position = position_jitter(width = 0.1)) +\n  geom_text(data = top5, \n            aes(label = dest_country),\n            nudge_y = 10) +\n  geom_text(data = bottom5, \n            aes(label = dest_country),\n            nudge_y = -10) +\n  labs(x = NULL, \n       y = \"Relative Travel Freedom\",\n       title = \"Passport Power by Region\",\n       subtitle = \"Shows the difference between the *number of countries a passport-holder can travel to visa-free* and <br> the *number of countries from which people can enter visa-free*.<br><br>Passport holders from countries with high relative travel freedom can travel to many places<br>without a visa, but not many people from other countries can enter without a visa. Conversely,<br>passport holders from countries with low relative travel freedom cannot travel many places<br>without a visa, while passport-holders from many other countries can enter freely.\") +\n  scale_color_paletteer_d(\"MetBrewer::Austria\") +\n  theme_minimal() +\n  theme(legend.position = \"none\",\n        plot.subtitle = element_markdown(),\n        plot.title = element_text(face = \"bold\"))\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}